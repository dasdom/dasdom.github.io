<!DOCTYPE html><html><head><meta charset="UTF-8"/><meta name="og:site_name" content="dasdom"/><link rel="canonical" href="https://dasdom.dev/posts/grand-central-dispach-timer"/><meta name="twitter:url" content="https://dasdom.dev/posts/grand-central-dispach-timer"/><meta name="og:url" content="https://dasdom.dev/posts/grand-central-dispach-timer"/><title>Grand Central Dispatch Timer | dasdom</title><meta name="twitter:title" content="Grand Central Dispatch Timer | dasdom"/><meta name="og:title" content="Grand Central Dispatch Timer | dasdom"/><meta name="description" content="How to build a timer that works on a background thread."/><meta name="twitter:description" content="How to build a timer that works on a background thread."/><meta name="og:description" content="How to build a timer that works on a background thread."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/styles.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to dasdom"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">dasdom</a><nav><ul><li><a class="selected" href="/posts">Posts</a></li><li><a href="/books">Books</a></li><li><a href="/about">About</a></li><li><a href="/imprint">Imprint</a></li><li><a href="/privacy">Privacy</a></li></ul></nav></div></header><div class="wrapper"><p>12. Feb 2020</p><article><div class="content"><h1>Grand Central Dispatch Timer</h1><p>Last week I needed to fire a timer on a background thread. You can do this with a <code>Timer</code> that is added to a run loop on a background thread.</p><p>Here is a different approach using Grand Central Dispatch. This method returns a timer that fires on a background thread.</p><pre><code><span class="keyword">func</span> gcdTimer(delay: <span class="type">DispatchWallTime</span> = .<span class="call">now</span>(),
              repeating: <span class="type">DispatchTimeInterval</span> = .<span class="dotAccess">never</span>,
              leeway: <span class="type">DispatchTimeInterval</span> = .<span class="call">milliseconds</span>(<span class="number">100</span>),
              action: <span class="keyword">@escaping</span> ()-&gt;<span class="type">Void</span>) -&gt; <span class="type">DispatchSourceTimer</span> {
  
  <span class="keyword">let</span> queue = <span class="type">DispatchQueue</span>(label: <span class="string">"de.dasdom.my.queue"</span>)
  <span class="keyword">let</span> timer = <span class="type">DispatchSource</span>.<span class="call">makeTimerSource</span>(queue: queue)
  timer.<span class="call">schedule</span>(wallDeadline: delay, repeating: repeating, leeway: leeway)
  timer.<span class="call">setEventHandler</span>(handler: action)
  timer.<span class="call">resume</span>()
  <span class="keyword">return</span> timer
}
</code></pre><p>First we create a <code>DispatchQueue</code>. With this queue we create a <code>DispatchSourceTimer</code>. In the next line we schedule the timer using a delay, a repeating interval and a leeway. The leeway gives the system some flexibility in how it manages the system resources. Next we add the action that should be executed when the timer fires. Don't forget to call <code>resume()</code> on the timer.</p><p>To invalidate the timer call <code>cancel()</code> on it.</p><p>That's it. This is a timer that fires on a background thread.</p><p>I thought about putting that into a Swift Package. But that felt a lot like <a href="https://www.theregister.co.uk/2016/03/23/npm_left_pad_chaos/">leftpad</a>. So I wrote a blog post about it to find it again when I need it.</p><p>Follow me on <a href="https://twitter.com/dasdom">Twitter</a>.<br>Check out my open source code at <a href="https://github.com/dasdom">Github</a>.</p></div><span>Tagged with: </span><ul class="tag-list"><li><a href="/tags/xcode">Xcode</a></li><li><a href="/tags/breakpoints">Breakpoints</a></li></ul></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a><a> | </a><a href="https://twitter.com/dasdom">Twitter</a><a> | </a><a href="https://stackoverflow.com/users/498796/dasdom">StackOverflow</a><a> | </a><a href="https://github.com/dasdom">Github</a><a> | </a><a href="https://pragprog.com/titles/dhios/">My Book</a></p></footer></body></html>