I"Ë	<p>Right now I am working on an update for [Phy](https://itunes.apple.com/de/app/phy-physics-formulas-calculator/id325836855?l=en&amp;mt=8).</p>
<p>One of the things which had to be improved was calculation string in the calculator. As a physicist I often had the problem that is was difficult to keep an overview of all the opening and closing parenthesis. One solution could be to use different types of parenthesis. But this is something I don't like ascetically. Even when I write formulas on paper I only use on pair of parenthesis.</p>
<p>Another solution could be to use different colors for different pairs of parenthesis. The only problem in the implementation of this solution is, that the parentheses can be nested. So in the example `(1+(2+3))`. The first opening and the last closing parentheses should have the same color and it should be different from the color of the second opening and the first closing parentheses.</p>
<p>Here is what I wanted to accomplish for a more complicated example:<br />
<a href="http://swift.eltanin.uberspace.de/wp-content/uploads/2014/05/attributedCalcString.png"><img src="/assets/attributedCalcString.png" alt="attributedCalcString" width="414" height="74" class="alignnone size-full wp-image-211" /></a></p>
<p>I solved this problem by iterating through the string and find the first closing parenthesis. On the way I stored the location of all the opening parentheses in an array. Then, when the first closing parenthesis was found, I have just look for the last opening parenthesis which was stored. This was then removed from the array and a range from the opening to the closing parenthesis is added to another array. This sounds quite complicated but in fact is very easy to do. This is the code I use to create an attributed string to color all pairs of parentheses and the calculation signs. In addition all unmatched opening parentheses are colored in red.</p>
<pre class="lang:objc decode:true ">- (NSAttributedString*)coloredAttributedStringFromString:(NSString*)string {
    
    NSMutableArray *openArray = [NSMutableArray array];
    
    NSMutableArray *parenthesesPairsArray = [NSMutableArray array];
    NSMutableArray *calcSignsRanges = [NSMutableArray array];
    
    if (self.calculationSigns) {
        self.calculationSigns = @[@"/", @"â¨¯", @"âˆ’", @"+"];
    }
    if (!self.openingParenthesis) {
        self.openingParenthesis = @"(";
    }
    if (!self.closingParenthesis) {
        self.closingParenthesis = @")";
    }
</pre>
:ET