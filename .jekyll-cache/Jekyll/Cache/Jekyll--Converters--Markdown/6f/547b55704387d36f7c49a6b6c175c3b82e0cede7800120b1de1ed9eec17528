I"¥<p>Yesterday I read <a href="http://tech.jjude.com/double-loops/">this post</a> by
<a href="https://twitter.com/jjude">Joseph Jude</a>. He experienced that Swift is
way slower in solving the 4th problem from Project Euler when compared
to Python and Typescript.</p>

<p>The <a href="https://projecteuler.net/problem=4">4th problem in Project Euler</a>
is this:</p>

<blockquote>
  <p>A palindromic number reads the same both ways. The largest palindrome
made from the product of two 2-digit numbers is 9009 = 91 Ã— 99.
<!--more-->
Find the largest palindrome made from the product of two 3-digit
numbers.</p>
</blockquote>

<p>The solution of Joseph looked like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">var</span> <span class="nv">answer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">var</span> <span class="nv">k</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">var</span> <span class="nv">s</span> <span class="o">=</span> <span class="s">""</span>
<span class="k">for</span> <span class="n">i</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">100</span><span class="o">...</span><span class="mi">999</span><span class="p">)</span><span class="o">.</span><span class="nf">reverse</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">j</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">100</span><span class="o">...</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="nf">reverse</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span>
    <span class="n">s</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="kt">String</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">characters</span><span class="o">.</span><span class="nf">reverse</span><span class="p">())</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">answer</span> <span class="p">{</span>
      <span class="n">answer</span> <span class="o">=</span> <span class="n">k</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">answer</span><span class="p">)</span></code></pre></figure>

<p>He states that this code needs 22 seconds to execute. Wow, 22 seconds.
This is a lot. Especially when compared to Python. Joseph writes that
the Python version takes 0.33 seconds to execute.</p>

<p>One reason for Swift being that slow is that the initialization of
strings is quite expensive. Swift strings are very complicated. Another
reason is that Joseph presumably compiled without any optimization. So
letâ€™s see what happens when we fix both problems.</p>

<p>First letâ€™s get rid of the String creation. This is a solution without
strings:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">dateBefore</span> <span class="o">=</span> <span class="kt">NSDate</span><span class="p">()</span>
<span class="k">var</span> <span class="nv">answer</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">100</span><span class="o">...</span><span class="mi">999</span><span class="p">)</span><span class="o">.</span><span class="nf">reverse</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">for</span> <span class="n">j</span> <span class="nf">in</span> <span class="p">(</span><span class="mi">100</span><span class="o">...</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="nf">reverse</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span>
    <span class="k">let</span> <span class="nv">temp</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">var</span> <span class="nv">array</span><span class="p">:</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">array</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="o">%</span><span class="mi">10</span><span class="p">)</span>
      <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">/</span><span class="kt">Int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="n">temp</span> <span class="o">&gt;</span> <span class="n">answer</span> <span class="o">&amp;&amp;</span> <span class="n">array</span> <span class="o">==</span> <span class="n">array</span><span class="o">.</span><span class="nf">reverse</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">answer</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">diff</span> <span class="o">=</span> <span class="n">dateBefore</span><span class="o">.</span><span class="n">timeIntervalSinceNow</span>
<span class="nf">print</span><span class="p">(</span><span class="s">"</span><span class="se">\(</span><span class="n">diff</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">answer</span><span class="se">)</span><span class="s">"</span><span class="p">)</span></code></pre></figure>

<p>I have added code to measure the execution time. Without any
optimization I get an execution time of 0.84 seconds on my MacBook Air.
With an optimization of Fast [-O] the execution time goes down to 0.42
seconds.</p>

<p>I think there is still room for improvement in the algorithm but 0.42 is
already way better than 22.</p>
:ET