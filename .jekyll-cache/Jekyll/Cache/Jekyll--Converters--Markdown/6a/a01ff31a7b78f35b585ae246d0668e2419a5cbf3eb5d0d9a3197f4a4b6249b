I"<p>Recently I updated my formulary app after three years of absence from the App Store. Now I try to make it the best formulary app in the App Store again. The best formulary app in 2019 needs to support dynamic type.</p>

<p>One of the main features of my formulary app is the calculator. For the update I rewrote the UI from scratch using <code class="highlighter-rouge">UIButton</code>s and <code class="highlighter-rouge">UIStackView</code>s. For the next update I wanted the calculator to support dynamic type. But the naïve approach didn’t work.</p>

<h1 id="the-naïve-approach">The Naïve Approach</h1>

<p><code class="highlighter-rouge">UIButton</code> has a <code class="highlighter-rouge">UILabel</code> subview to hold the title. To set the font of the button you need to set the font of that label.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="k">let</span> <span class="nv">button</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">system</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">titleLabel</span><span class="p">?</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="o">.</span><span class="nf">preferredFont</span><span class="p">(</span><span class="nv">forTextStyle</span><span class="p">:</span> <span class="o">.</span><span class="n">body</span><span class="p">)</span>
<span class="n">button</span><span class="o">.</span><span class="n">titleLabel</span><span class="p">?</span><span class="o">.</span><span class="n">adjustsFontForContentSizeCategory</span> <span class="o">=</span> <span class="kc">true</span></code></pre></figure>

<p>The last line tells UIKit that the font should be changed whenever the user changes the text size in settings or from Control Center. If the font is changed from small to huge while the app is running, the result looks like this (I added a border around the label for clarification):</p>

<p style="text-align: center;"><img src="../assets/2019-08-09/button_font_small.png" alt="Before the font change" /></p>

<p style="text-align: center;"><img src="../assets/2019-08-09/button_font_huge.png" alt="After the font change" /></p>

<p>So this doesn’t work.</p>

<p>To make dynamic type work in a UIButton, I needed to add a strange hack to a UIButton subclass.</p>

<h1 id="custom-subclass">Custom Subclass</h1>

<p>The resizing of the title label works if I use a subclass of <code class="highlighter-rouge">UIButton</code> that looks like this:</p>

<figure class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">@implementation</span> <span class="nc">CalculatorButton</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">traitCollectionDidChange</span><span class="p">:(</span><span class="n">UITraitCollection</span> <span class="o">*</span><span class="p">)</span><span class="nv">previousTraitCollection</span> <span class="p">{</span>
  
  <span class="n">NSString</span> <span class="o">*</span><span class="n">text</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">currentTitle</span><span class="p">;</span>
  
  <span class="p">[</span><span class="n">self</span> <span class="nf">setTitle</span><span class="p">:</span><span class="nb">nil</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
  <span class="p">[</span><span class="n">self</span> <span class="nf">setTitle</span><span class="p">:</span><span class="n">text</span> <span class="nf">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">@end</span></code></pre></figure>

<p>If you have any feedback you can find me on <a href="https://twitter.com/dasdom">Twitter</a>.</p>
:ET